跟着慕课网的教程完成了这个简单的demo，在做的过程中没有遇到什么新的技术，最后看了教程的完整版代码，还是有一点点收获的。

## 知识点总结
整个过程中都使用了jQuery的方法，元素的选取，异步流程的实现，元素位置的获取，动画的添加等等，其实这些都可以使用原生方法来实现，只是可能浏览器兼容不太好。

- 获取元素相对于视口的位置和大小
 可以使用``element.getBoundingClientRect()``,``offsetLeft``等等方法

- 获取元素的大小
  使用``element.offsetHeight``，``element.clientHeight``等，找个时间把所有的原生方法都详细的查一遍记录下来。

- 动态添加动画
 可以使用``element.animate()``方法，或者动态添加类名的方法来触发动画

- 对于类名的添加和删除
 HTML5已经为元素增加了一个classList属性，其中有``addClass()``，``removeClass()``等方法可以使用，只是浏览器兼容不太好。

- 异步程序的实现
 其实案例中使用的异步有很多是没有必要的，比如连续的动画效果，可以使用``animation``的``animation-delay``属性指定延迟的时间，这样就可以依次播放动画了，而且一个元素是可以同时指定多个动画的
 如果想要实现异步程序，可以使用ES6的promise，或者新出的await方法，后者还没有查看过

- 面向对象编程
 从这个案例中学到了一些对于代码的封装以及创建对象来实现整个程序功能的方法。

## 重构整个案例的思路

使用css3的``animation``来实现大部分动画效果，但是有一部分的动画，如人物移动的距离，是事先不可知的，所以需要在运行时计算移动的距离，缩放的比例。要达到这样的需求，使用``animation``是不行的，因为``animation``需要实现准备好动画的关键帧。

所以完成的思路就是使用``transition``属性。而使用``transition``就需要监听transitionend事件，以便在完成后进行下一步的动作。

但是为了避免添加的监听事件在其他的transitionend时运行，所以要在运行完该程序后再移除这个eventListener。
简单看了下jQuery的transition库，就是用了这种方法，在浏览器不支持transitionend事件时，用了``setTimeout()``，在相同的时间之后执行回调函数。

**PS:**如果想要在事件监听函数中移除这个监听器，可以使用``argument.callee``属性。

### 使用模块化编程的思想
案例中，在人物走到花店门口进去买花的过程中，花店进行了一系列的动画，包括，灯亮，开门，等待人物进店，关门，灯灭。所以可以将花店封装成一个对象，来进行一系列的动画。

## 2017-07-03
使用了CSS3和``animationend``与``transitionend``事件完成了这个案例的重写，但是和原来的效果相差还是挺大的，主要表现在:
1. 人物进入商店的效果使用了``transform: translate(npx, npx)``，出来的动画也是使用了transform,但是不知道为什么人物的x位置是从第一次使用transform之前开始的
**已找出原因，是在走出商店更改类的时候，导致之前行走的animation被重新计算，所以人物回到了使用第一个transform之前的状态**
2. 由于人物的在场景中的x方向的移动是使用了transform而不是使用了left，所以没有对走到桥边进行精确的控制，而是直接走上了桥
3. 整个过程都没有使用promise而是使用了动画结束事件，所以代码的结构十分混论